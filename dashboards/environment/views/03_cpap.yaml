type: sections
title: CPAP
sections:
  - type: grid
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: "Aaron’s CPAP – ResMed myAir"
            subtitle: "Last sync: {{ states('sensor.cpap_current_data_date') }}"
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                entity: sensor.cpap_ahi_events_per_hour
                primary: "{{ 'AHI: ' ~ states(entity) }}"
                secondary: Events per hour
                icon: mdi:chart-bell-curve
                icon_color: >-
                  {% set ahi = states(entity) | float(0) %}
                  {% if ahi < 1 %}
                    green
                  {% elif ahi < 5 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
              - type: custom:mushroom-template-card
                entity: sensor.cpap_mask_leak
                primary: "{{ 'Leak: ' ~ states(entity) }}%"
                secondary: Mask leak
                icon: mdi:air-filter
                icon_color: >-
                  {% set leak = states(entity) | float(0) %}
                  {% if leak == 0 %}
                    green
                  {% elif leak < 10 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                entity: sensor.cpap_total_myair_score
                primary: "{{ 'myAir Score: ' ~ states(entity) }}"
                secondary: Daily score
                icon: mdi:star-circle
                icon_color: >-
                  {% set score = states(entity) | int(0) %}
                  {% if score == 0 %}
                    gray
                  {% elif score >= 90 %}
                    green
                  {% elif score >= 70 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
              - type: custom:mushroom-template-card
                entity: sensor.cpap_usage_minutes
                primary: >-
                  {% set mins = states(entity) | int(0) %}
                  {{ (mins // 60) ~ 'h ' ~ (mins % 60) ~ 'm' }}
                secondary: Usage duration
                icon: mdi:sleep
                icon_color: >-
                  {% set mins = states(entity) | int(0) %}
                  {% if mins >= 360 %}
                    green
                  {% elif mins >= 240 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
      - type: vertical-stack
        cards:
          - type: custom:apexcharts-card
            header:
              show: true
              title: AHI, last 14 days
              show_states: true
            graph_span: 14d
            span:
              end: day
            apex_config:
              yaxis:
                min: 0
                title:
                  text: events/hour
              annotations:
                yaxis:
                  - 'y': 5
                    borderColor: var(--warning-color)
                    label:
                      text: Goal
                      position: left
                      textAnchor: start
                  - 'y': 1
                    borderColor: var(--success-color)
                    label:
                      text: Excellent
                      position: left
                      textAnchor: start
            series:
              - entity: sensor.cpap_ahi_events_per_hour
                name: AHI
                type: line
                group_by:
                  duration: 1d
                  func: last
                show:
                  extremas: true
                stroke_width: 3
          - type: custom:apexcharts-card
            header:
              show: true
              title: Usage, last 14 days
              show_states: true
            graph_span: 14d
            span:
              end: day
            apex_config:
              yaxis:
                min: 0
                title:
                  text: hours
              annotations:
                yaxis:
                  - 'y': 6
                    borderColor: var(--success-color)
                    label:
                      text: Goal
                      position: left
                      textAnchor: start
            series:
              - entity: sensor.cpap_usage_minutes
                name: Hours used
                type: column
                group_by:
                  duration: 1d
                  func: last
                transform: return x / 60;
                show:
                  extremas: true
  - type: grid
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: "Ashley’s CPAP – ResMed myAir"
            subtitle: "Last sync: {{ states('sensor.ashley_cpap_current_data_date') }}"
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                entity: sensor.ashley_cpap_ahi_events_per_hour
                primary: "{{ 'AHI: ' ~ states(entity) }}"
                secondary: Events per hour
                icon: mdi:chart-bell-curve
                icon_color: >-
                  {% set ahi = states(entity) | float(0) %}
                  {% if ahi < 1 %}
                    green
                  {% elif ahi < 5 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
              - type: custom:mushroom-template-card
                entity: sensor.ashley_cpap_mask_leak
                primary: "{{ 'Leak: ' ~ states(entity) }}%"
                secondary: Mask leak
                icon: mdi:air-filter
                icon_color: >-
                  {% set leak = states(entity) | float(0) %}
                  {% if leak == 0 %}
                    green
                  {% elif leak < 10 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                entity: sensor.ashley_cpap_total_myair_score
                primary: "{{ 'myAir Score: ' ~ states(entity) }}"
                secondary: Daily score
                icon: mdi:star-circle
                icon_color: >-
                  {% set score = states(entity) | int(0) %}
                  {% if score == 0 %}
                    gray
                  {% elif score >= 90 %}
                    green
                  {% elif score >= 70 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
              - type: custom:mushroom-template-card
                entity: sensor.ashley_cpap_usage_minutes
                primary: >-
                  {% set mins = states(entity) | int(0) %}
                  {{ (mins // 60) ~ 'h ' ~ (mins % 60) ~ 'm' }}
                secondary: Usage duration
                icon: mdi:sleep
                icon_color: >-
                  {% set mins = states(entity) | int(0) %}
                  {% if mins >= 360 %}
                    green
                  {% elif mins >= 240 %}
                    yellow
                  {% else %}
                    red
                  {% endif %}
      - type: vertical-stack
        cards:
          - type: custom:apexcharts-card
            header:
              show: true
              title: AHI, last 14 days
              show_states: true
            graph_span: 14d
            span:
              end: day
            apex_config:
              yaxis:
                min: 0
                title:
                  text: events/hour
              annotations:
                yaxis:
                  - 'y': 5
                    borderColor: var(--warning-color)
                    label:
                      text: Goal
                      position: left
                      textAnchor: start
                  - 'y': 1
                    borderColor: var(--success-color)
                    label:
                      text: Excellent
                      position: left
                      textAnchor: start
            series:
              - entity: sensor.ashley_cpap_ahi_events_per_hour
                name: AHI
                type: line
                group_by:
                  duration: 1d
                  func: last
                show:
                  extremas: true
                stroke_width: 3
          - type: custom:apexcharts-card
            header:
              show: true
              title: Usage, last 14 days
              show_states: true
            graph_span: 14d
            span:
              end: day
            apex_config:
              yaxis:
                min: 0
                title:
                  text: hours
              annotations:
                yaxis:
                  - 'y': 6
                    borderColor: var(--success-color)
                    label:
                      text: Goal
                      position: left
                      textAnchor: start
            series:
              - entity: sensor.ashley_cpap_usage_minutes
                name: Hours used
                type: column
                group_by:
                  duration: 1d
                  func: last
                transform: return x / 60;
                show:
                  extremas: true
