###############################################################################
# Plant care package: Haworthia fasciata (haworthia fasciata)
# Generated by generate_plant_assets.py
###############################################################################
homeassistant:
  customize:
    plant.haworthia_fasciata:
      friendly_name: "Haworthia fasciata"

plant:
  haworthia_fasciata:
    sensors:
      moisture: sensor.haworthia_fasciata_moisture_routed
      temperature: sensor.haworthia_fasciata_temperature_routed
      brightness: sensor.haworthia_fasciata_illuminance_routed
      conductivity: sensor.haworthia_fasciata_conductivity_routed

template:
  - sensor:
      - name: "Haworthia fasciata Light Min Lux"
        unique_id: "haworthia_fasciata_light_min_lux"
        state: "2500.0"
        unit_of_measurement: "lx"
      - name: "Haworthia fasciata Light Max Lux"
        unique_id: "haworthia_fasciata_light_max_lux"
        state: "55000.0"
        unit_of_measurement: "lx"
      - name: "Haworthia fasciata Temp Min"
        unique_id: "haworthia_fasciata_temp_min"
        state: "5.0"
        unit_of_measurement: "°C"
      - name: "Haworthia fasciata Temp Max"
        unique_id: "haworthia_fasciata_temp_max"
        state: "35.0"
        unit_of_measurement: "°C"
      - name: "Haworthia fasciata Humidity Min"
        unique_id: "haworthia_fasciata_humid_min"
        state: "15.0"
        unit_of_measurement: "%"
      - name: "Haworthia fasciata Humidity Max"
        unique_id: "haworthia_fasciata_humid_max"
        state: "80.0"
        unit_of_measurement: "%"
      - name: "Haworthia fasciata Moisture Min"
        unique_id: "haworthia_fasciata_moist_min"
        state: "7.0"
        unit_of_measurement: "%"
      - name: "Haworthia fasciata Moisture Max"
        unique_id: "haworthia_fasciata_moist_max"
        state: "50.0"
        unit_of_measurement: "%"
      - name: "Haworthia fasciata EC Min"
        unique_id: "haworthia_fasciata_ec_min"
        state: "300.0"
        unit_of_measurement: "µS/cm"
      - name: "Haworthia fasciata EC Max"
        unique_id: "haworthia_fasciata_ec_max"
        state: "1000.0"
        unit_of_measurement: "µS/cm"

  - binary_sensor:
      - name: "Haworthia fasciata Temperature OK"
        unique_id: "haworthia_fasciata_temp_ok"
        device_class: problem
        state: >-
          {% from 'units/base.jinja' import u_convert_entity %}
          {% set t = u_convert_entity('sensor.haworthia_fasciata_temperature_routed', 'c')|float(none) %}
          {% set tmin = states('sensor.haworthia_fasciata_temp_min')|float(none) %}
          {% set tmax = states('sensor.haworthia_fasciata_temp_max')|float(none) %}
          {{ t is not none and tmin is not none and tmax is not none and (tmin <= t <= tmax) }}
      - name: "Haworthia fasciata Light OK"
        unique_id: "haworthia_fasciata_light_ok"
        device_class: problem
        state: >-
          {% set l = states('sensor.haworthia_fasciata_illuminance_routed')|float(none) %}
          {% set lmin = states('sensor.haworthia_fasciata_light_min_lux')|float(none) %}
          {% set lmax = states('sensor.haworthia_fasciata_light_max_lux')|float(none) %}
          {{ l is not none and lmin is not none and lmax is not none and (lmin <= l <= lmax) }}
      - name: "Haworthia fasciata Moisture OK"
        unique_id: "haworthia_fasciata_moist_ok"
        device_class: problem
        state: >-
          {% set m = states('sensor.haworthia_fasciata_moisture_routed')|float(none) %}
          {% set mmin = states('sensor.haworthia_fasciata_moisture_min')|float(none) %}
          {% set mmax = states('sensor.haworthia_fasciata_moisture_max')|float(none) %}
          {{ m is not none and mmin is not none and mmax is not none and (mmin <= m <= mmax) }}
      - name: "Haworthia fasciata EC OK"
        unique_id: "haworthia_fasciata_ec_ok"
        device_class: problem
        state: >-
          {% set e = states('sensor.haworthia_fasciata_conductivity_routed')|float(none) %}
          {% set emin = states('sensor.haworthia_fasciata_ec_min')|float(none) %}
          {% set emax = states('sensor.haworthia_fasciata_ec_max')|float(none) %}
          {{ e is not none and emin is not none and emax is not none and (emin <= e <= emax) }}
      - name: "Haworthia fasciata All OK"
        unique_id: "haworthia_fasciata_all_ok"
        device_class: problem
        state: >-
          {{ is_state('binary_sensor.haworthia_fasciata_temperature_ok','on')
             and is_state('binary_sensor.haworthia_fasciata_light_ok','on')
             and is_state('binary_sensor.haworthia_fasciata_moisture_ok','on')
             and is_state('binary_sensor.haworthia_fasciata_ec_ok','on') }}

          {%- set temp_min_f = u_humanize_value(u_convert_entity('sensor.haworthia_fasciata_temp_min', 'f'), '°F') -%}
          {%- set temp_max_f = u_humanize_value(u_convert_entity('sensor.haworthia_fasciata_temp_max', 'f'), '°F') -%}
          {{ 'Current: ' ~ u_humanize_entity(entity) }}
          {{ '\nRange: ' ~ temp_min_f ~ '–' ~ temp_max_f }}

  - sensor:
      - name: "Haworthia fasciata Care Notes"
        unique_id: "haworthia_fasciata_care_notes"
        icon: mdi:leaf
        state: >-
          {% from 'units/base.jinja' import u_convert_value, u_convert_entity, u_humanize_value, u_humanize_entity %}
          {% set ns = namespace(out=[]) %}
          {% set t = u_convert_entity('sensor.haworthia_fasciata_temperature_routed', 'c')|float(none) %}
          {% set l = states('sensor.haworthia_fasciata_illuminance_routed')|float(none) %}
          {% set m = states('sensor.haworthia_fasciata_moisture_routed')|float(none) %}
          {% set e = states('sensor.haworthia_fasciata_conductivity_routed')|float(none) %}
          {% set tmin = states('sensor.haworthia_fasciata_temp_min')|float(none) %}
          {% set tmax = states('sensor.haworthia_fasciata_temp_max')|float(none) %}
          {% set tminf = u_humanize_value(u_convert_entity('sensor.haworthia_fasciata_temp_min', 'f'), '°F') -%}
          {% set tmaxf = u_humanize_value(u_convert_entity('sensor.haworthia_fasciata_temp_max', 'f'), '°F') -%}
          {% set lmin = states('sensor.haworthia_fasciata_light_min_lux')|float(none) %}
          {% set lmax = states('sensor.haworthia_fasciata_light_max_lux')|float(none) %}
          {% set mmin = states('sensor.haworthia_fasciata_moisture_min')|float(none) %}
          {% set mmax = states('sensor.haworthia_fasciata_moisture_max')|float(none) %}
          {% set emin = states('sensor.haworthia_fasciata_ec_min')|float(none) %}
          {% set emax = states('sensor.haworthia_fasciata_ec_max')|float(none) %}
          {% if t is not none and (t < tmin or t > tmax) %}
            {% if t < tmin %}
              {% set ns.out = ns.out + ['Warm environment to ' ~ u_humanize_value(tmin,'°C') ~ '–' ~ u_humanize_value(tmax,'°C') ~ ' (' ~ tminf ~ '–' ~ tmaxf ~ ').'] %}
            {% else %}
              {% set ns.out = ns.out + ['Cool environment to ' ~ u_humanize_value(tmin,'°C') ~ '–' ~ u_humanize_value(tmax,'°C') ~ ' (' ~ tminf ~ '–' ~ tmaxf ~ ').'] %}
            {% endif %}
          {% endif %}
          {% if l is not none and (l < lmin or l > lmax) %}
            {% if l < lmin %}
              {% set ns.out = ns.out + ['Increase light toward ' ~ u_humanize_value(lmin) ~ '–' ~ u_humanize_value(lmax,'lx') ~ '.'] %}
            {% else %}
              {% set ns.out = ns.out + ['Reduce direct light; target ' ~ u_humanize_value(lmin) ~ '–' ~ u_humanize_value(lmax,'lx') ~ ' .'] %}
            {% endif %}
          {% endif %}
          {% if m is not none and (m < mmin or m > mmax) %}
            {% if m < mmin %}
              {% set ns.out = ns.out + ['Water thoroughly; maintain soil moisture ' ~ u_humanize_value(mmin,'%') ~ '–' ~ u_humanize_value(mmax,'%') ~ '.'] %}
            {% else %}
              {% set ns.out = ns.out + ['Allow soil to dry slightly; keep ' ~ u_humanize_value(mmin,'%') ~ '–' ~ u_humanize_value(mmax,'%') ~ '.'] %}
            {% endif %}
          {% endif %}
          {% if e is not none and (e < emin or e > emax) %}
            {% if e < emin %}
              {% set ns.out = ns.out + ['Feed lightly; EC ' ~ u_humanize_value(emin) ~ '–' ~ u_humanize_value(emax) ~ ' µS/cm.'] %}
            {% else %}
              {% set ns.out = ns.out + ['Flush to reduce salts; resume gentle feeding.'] %}
            {% endif %}
          {% endif %}
          {{ (ns.out | join('\n')) if ns.out else 'Optimal. Maintain current care.' }}
        attributes:
          image: "http://pkb.resource.huahuacaocao.com/aGF3b3J0aGlhIGZhc2NpYXRhLmpwZw==?imageView2/1/w/%d/h/%d"
          alias: "haworthia fasciata"
          origin: "South Africa"
          production: "China"
          category: "Liliaceae, Faucaria"
          floral_language: |-
            Haworthia fasciata
            Floriography: classical, grand, strong
            Has a peculiar triangular needle-like leaf shape, leaves are closely arranged like a rosette, rigid and covered by many white raised structures forming stripes, with a great daily temperature range and abundant sunlight, leaves turn red, 
            Likes sunshine, tolerates to half shade, has a short dormant period in summer, shade properly in a cool environment. Flowers are red. Flowers are white green.
          blooming: "Succulent plants, sometimes flowers, light green flowers"
          color: "Leaf color dark green, with adequate sunlight slightly red"
          size: "Diameter ≥ 5 cm, height ≥ 5 cm"
          soil: "Peat and akadama mixed in 3:1 ratio"
          sunlight: "Likes light, avoid strong direct light, dormant in summer under high temperatures, put in places with scattered light"
          watering: "Resistant to drought, water thoroughly when soil is dry, reduce water in summer"
          fertilization: "Dilute fertilizers following instructions,  apply once every 1-2 months in spring and autumn"
          pruning: "Remove dead and rotten part timely"

# ---------------- thresholds from CSV (edit freely) ----------------
# Light mmol: min=2700.0, max=5400.0
# Light lux:  min=2500.0,  max=55000.0
# Temp C:     min=5.0,       max=35.0
# Humidity %: min=15.0,      max=80.0
# Moisture%:  min=7.0,      max=50.0
# EC µS/cm:   min=300.0,         max=1000.0

