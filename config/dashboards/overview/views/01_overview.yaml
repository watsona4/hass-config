# File: dashboards/overview/views/01_overview.yaml
# Description: Overview dashboard main view configuration

title: Home
max_columns: 2
sections:

  # Overall Overview
  - type: grid
    cards:

      # Climate and Quick Setpoints
      - type: custom:mushroom-title-card
        title: Home Status
        subtitle: Presence • Climate • Connectivity • Usage

      # Climate States
      - type: custom:mushroom-chips-card
        alignment: center
        chips:
          - type: template
            entity: input_boolean.someone_is_home
            content: "{{ state_attr('sensor.ui_someone_is_home_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_someone_is_home_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_someone_is_home_chip', 'color') }}"
            tap_action:
              action: more-info
          - type: template
            entity: input_boolean.home_alone
            content: "{{ state_attr('sensor.ui_home_alone_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_home_alone_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_home_alone_chip', 'color') }}"
            tap_action:
              action: more-info
          - type: template
            entity: input_boolean.coming_home
            content: "{{ state_attr('sensor.ui_coming_home_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_coming_home_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_coming_home_chip', 'color') }}"
            tap_action:
              action: more-info
          - type: template
            entity: binary_sensor.daytime
            content: "{{ state_attr('sensor.ui_daytime_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_daytime_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_daytime_chip', 'color') }}"
            tap_action:
              action: more-info

      # Climate Cards
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-climate-card
            entity: climate.downstairs_thermostat
            name: Downstairs
          - type: custom:mushroom-climate-card
            entity: climate.upstairs_thermostat
            name: Upstairs
      
      # Network Status
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-template-card
            entity: sensor.home_download_rate
            icon: "{{ state_attr('sensor.ui_home_download_rate', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_home_download_rate', 'color') }}"
            primary: Download
            secondary: "{{ state_attr('sensor.ui_home_download_rate', 'label_vertical') }}"
            badge_icon: "{{ state_attr('sensor.ui_home_download_rate', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_home_download_rate', 'badge_color') }}"
            layout: vertical
            multiline_secondary: true
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.home_upload_rate
            icon: "{{ state_attr('sensor.ui_home_upload_rate', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_home_upload_rate', 'color') }}"
            primary: Upload
            secondary: "{{ state_attr('sensor.ui_home_upload_rate', 'label_vertical') }}"
            badge_icon: "{{ state_attr('sensor.ui_home_upload_rate', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_home_upload_rate', 'badge_color') }}"
            layout: vertical
            multiline_secondary: true
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.home_latency_icmp
            icon: "{{ state_attr('sensor.ui_home_latency_icmp', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_home_latency_icmp', 'color') }}"
            primary: Latency
            secondary: "{{ state_attr('sensor.ui_home_latency_icmp', 'label_vertical') }}"
            badge_icon: "{{ state_attr('sensor.ui_home_latency_icmp', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_home_latency_icmp', 'badge_color') }}"
            layout: vertical
            multiline_secondary: true
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto

      - type: grid
        columns: 2
        square: false
        cards:
          - type: custom:mushroom-person-card
            entity: person.aaron_watson
          - type: custom:mushroom-person-card
            entity: person.ashley_watson
          - type: custom:mushroom-person-card
            entity: person.eleanor_watson
          - type: custom:mushroom-person-card
            entity: person.michael_watson

  # Outside Weather and Stats
  - type: grid
    cards:

      # Outside Title
      - type: custom:mushroom-title-card
        title: "Outdoor Conditions"
        subtitle: "Weather • Air Quality • Energy Use"
            
      # Climate States
      - type: custom:mushroom-chips-card
        alignment: center
        chips:
          - type: template
            entity: binary_sensor.sunny
            content: "{{ state_attr('sensor.ui_sunny_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_sunny_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_sunny_chip', 'color') }}"
            tap_action:
              action: more-info
          - type: template
            entity: binary_sensor.rainy
            content: "{{ state_attr('sensor.ui_rainy_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_rainy_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_rainy_chip', 'color') }}"
            tap_action:
              action: more-info
          - type: template
            entity: binary_sensor.windy
            content: "{{ state_attr('sensor.ui_windy_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_windy_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_windy_chip', 'color') }}"
            tap_action:
              action: more-info
          - type: template
            entity: binary_sensor.hot_inside
            content: "{{ state_attr('sensor.ui_hot_inside_chip', 'label') }}"
            icon: "{{ state_attr('sensor.ui_hot_inside_chip', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_hot_inside_chip', 'color') }}"
            tap_action:
              action: more-info

      - type: grid
        columns: 2
        square: false
        cards:

          # Temperature and Humidity
          - type: custom:mushroom-template-card
            entity: sensor.outside_temperature_state
            icon: "{{ state_attr('sensor.ui_outside_temperature_state', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_outside_temperature_state', 'color') }}"
            primary: Outside Temp
            secondary: "{{ state_attr('sensor.ui_outside_temperature_state', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_outside_temperature_state', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_outside_temperature_state', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.outside_humidity_state
            icon: "{{ state_attr('sensor.ui_outside_humidity_state', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_outside_humidity_state', 'color') }}"
            primary: Outside Humidity
            secondary: "{{ state_attr('sensor.ui_outside_humidity_state', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_outside_humidity_state', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_outside_humidity_state', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto

          # Sunlight and UV Index
          - type: custom:mushroom-template-card
            entity: sensor.light_sensor_illuminance
            icon: "{{ state_attr('sensor.ui_light_sensor_illuminance', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_light_sensor_illuminance', 'color') }}"
            primary: Illuminance
            secondary: "{{ state_attr('sensor.ui_light_sensor_illuminance', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_light_sensor_illuminance', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_light_sensor_illuminance', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.nearby_uv_index
            icon: "{{ state_attr('sensor.ui_nearby_uv_index', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_nearby_uv_index', 'color') }}"
            primary: UV Index
            secondary: "{{ state_attr('sensor.ui_nearby_uv_index', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_nearby_uv_index', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_nearby_uv_index', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto

          # Wind and Precipitation
          - type: custom:mushroom-template-card
            entity: sensor.nearby_wind_speed
            icon: "{{ state_attr('sensor.ui_nearby_wind_speed', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_nearby_wind_speed', 'color') }}"
            primary: "{{ state_attr('sensor.ui_nearby_wind_speed', 'name') }}"
            secondary: "{{ state_attr('sensor.ui_nearby_wind_speed', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_nearby_wind_speed', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_nearby_wind_speed', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.nearby_today_precip_sum
            icon: "{{ state_attr('sensor.ui_nearby_today_precip_sum', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_nearby_today_precip_sum', 'color') }}"
            primary: "{{ state_attr('sensor.ui_nearby_today_precip_sum', 'name') }}"
            secondary: "{{ state_attr('sensor.ui_nearby_today_precip_sum', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_nearby_today_precip_sum', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_nearby_today_precip_sum', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto

          # Air Quality and Dew Point
          - type: custom:mushroom-template-card
            entity: sensor.waqi_nearby_aqi
            icon: "{{ state_attr('sensor.ui_waqi_nearby_aqi', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_waqi_nearby_aqi', 'color') }}"
            primary: Air Quality Index
            secondary: "{{ state_attr('sensor.ui_waqi_nearby_aqi', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_waqi_nearby_aqi', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_waqi_nearby_aqi', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.nearby_dew_point
            icon: "{{ state_attr('sensor.ui_nearby_dew_point', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_nearby_dew_point', 'color') }}"
            primary: Dew Point
            secondary: "{{ state_attr('sensor.ui_nearby_dew_point', 'label') }}"
            badge_icon: "{{ state_attr('sensor.ui_nearby_dew_point', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_nearby_dew_point', 'badge_color') }}"
            tap_action:
              action: more-info
            icon_tap_action:
              action: nothing
            grid_options:
              columns: 12
              rows: auto

      # Utility Usage
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-template-card
            entity: sensor.electric_daily
            icon: "{{ state_attr('sensor.ui_electric_daily', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_electric_daily', 'color') }}"
            primary: "{{ state_attr('sensor.ui_electric_daily', 'name') }}"
            secondary: "{{ state_attr('sensor.ui_electric_daily', 'label_vertical') }}"
            badge_icon: "{{ state_attr('sensor.ui_electric_daily', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_electric_daily', 'badge_color') }}"
            layout: vertical
            multiline_secondary: true
            tap_action:
              action: navigate
              navigation_path: /energy
            icon_tap_action:
              action: more-info
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.water_daily
            icon: "{{ state_attr('sensor.ui_water_daily', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_water_daily', 'color') }}"
            primary: "{{ state_attr('sensor.ui_water_daily', 'name') }}"
            secondary: "{{ state_attr('sensor.ui_water_daily', 'label_vertical') }}"
            badge_icon: "{{ state_attr('sensor.ui_water_daily', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_water_daily', 'badge_color') }}"
            layout: vertical
            multiline_secondary: true
            tap_action:
              action: navigate
              navigation_path: /energy
            icon_tap_action:
              action: more-info
            grid_options:
              columns: 12
              rows: auto
          - type: custom:mushroom-template-card
            entity: sensor.gas_daily
            icon: "{{ state_attr('sensor.ui_gas_daily', 'icon') }}"
            icon_color: "{{ state_attr('sensor.ui_gas_daily', 'color') }}"
            primary: "{{ state_attr('sensor.ui_gas_daily', 'name') }}"
            secondary: "{{ state_attr('sensor.ui_gas_daily', 'label_vertical') }}"
            badge_icon: "{{ state_attr('sensor.ui_gas_daily', 'badge') }}"
            badge_color: "{{ state_attr('sensor.ui_gas_daily', 'badge_color') }}"
            layout: vertical
            multiline_secondary: true
            tap_action:
              action: navigate
              navigation_path: /energy
            icon_tap_action:
              action: more-info
            grid_options:
              columns: 12
              rows: auto

  # Status - Lights, Doors, Smoke/CO
  - type: grid
    cards:

      # Status Title
      - type: custom:mushroom-title-card
        title: Status
        subtitle: Lights On • Doors & Windows Open • Smoke/CO Alerts

      # Smoke and CO Alerts
      - type: custom:auto-entities
        show_empty: false
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        filter:
          include:
            - entity_id: binary_sensor.nest_protect_*_smoke_status
              state: 'on'
              options:
                type: custom:mushroom-template-card
                entity: this.entity_id
                icon: mdi:fire-alert
                icon_color: red
                primary: "{{ area_name(entity) ~ ' Smoke Alarm' }}"
                tap_action:
                  action: more-info
            - entity_id: binary_sensor.nest_protect_*_co_status
              state: 'on'
              options:
                type: custom:mushroom-template-card
                entity: this.entity_id
                icon: mdi:molecule-co
                icon_color: red
                primary: "{{ area_name(entity) ~ ' CO Alarm' }}"
                tap_action:
                  action: more-info
          exclude: []

      # Lights On
      - type: custom:auto-entities
        show_empty: false
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        filter:
          include:
            - domain: light
              state: 'on'
              options:
                type: custom:mushroom-light-card
                tap_action:
                  action: more-info
          exclude:
            - entity_id: light.ratgdov25i_f6128e_light

      # Doors and Windows Open
      - type: custom:auto-entities
        show_empty: false
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        filter:
          include:
            - domain: binary_sensor
              attributes:
                device_class: door
              state: 'on'
              options:
                type: custom:mushroom-template-card
                primary: "{{ state_attr(entity, 'friendly_name') }}"
                icon: mdi:door-open
                icon_color: amber
                tap_action:
                  action: more-info
            - domain: binary_sensor
              attributes:
                device_class: window
              state: 'on'
              options:
                type: custom:mushroom-template-card
                primary: "{{ state_attr(entity, 'friendly_name') }}"
                icon: mdi:window-open
                icon_color: amber
                tap_action:
                  action: more-info
          exclude: []

  # Unavailable Devices
  - type: grid
    cards:

      # Unavailable Title
      - type: custom:mushroom-title-card
        title: Unavailable Devices
        subtitle: Impacted Devices • Count of Affected Entities

      # Unavailable Devices Cards
      - type: custom:auto-entities
        show_empty: false
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        filter:
          template: >-
            {%- set ns = namespace(out=[]) -%}
            {%- set devices = state_attr('sensor.ui_unavailable_devices','devices') or [] -%}
            {%- for d in devices -%}
              {%- set ns.out = ns.out + [d | combine({'type': 'custom:mushroom-template-card'})] -%}
            {%- endfor -%}
            {{ ns.out }}
          exclude:
            - device: Dishwasher
            - device: Shop Lights
            - device: Living Room Lights
            - device: Dining Room Lights
            - device: Eleanor Presence
            - device: Kids Bathroom Presence
            - domain: person
            - domain: weather
            - entity_id: /^.*\..*_ap$/
            - entity_id: /^.*\..*_co$/
            - entity_id: /^.*\..*_no2$/
            - entity_id: /^.*\..*_pm10$/
            - entity_id: /^.*\..*_so2$/
            - entity_id: /^sensor\.double_take_/
            - entity_id: binary_sensor.remote_ui
            - integration: dlna_dmr
            - integration: ibeacon
            - integration: mqtt
              device: DESKTOP-BQ063IG
            - integration: mqtt
              device: /[Ff]rigate/
            - integration: mqtt
              device: LAPTOP-OO58T6KN
            - integration: mqtt
              device: /[Oo]pnsense/
            - integration: smartthings
            - integration: tuya
        sort:
          method: name

  # Cameras and Pop-ups
  - type: grid
    column_span: 2
    square: false
    cards:

      # Cameras Title
      - type: custom:mushroom-title-card
        title: Cameras
        subtitle: Stills Only • Tap for Live
        grid_options:
          columns: full

      # Doorbell Camera
      - type: picture-entity
        entity: camera.doorbell_camera
        name: Doorbell
        camera_view: auto
        tap_action:
          action: more-info

      # Driveway Camera
      - type: picture-entity
        entity: camera.driveway_camera
        name: Driveway
        camera_view: auto
        tap_action:
          action: more-info

  # Climate Details
  - type: grid
    cards:

      # Climate Title
      - type: custom:mushroom-title-card
        title: "Climate Control"
        subtitle: "Thermostats • Humidity • Comfort"
        grid_options:
          columns: full

      - type: grid
        columns: 2
        square: false
        cards:

          # Climate and Humidity Cards
          - type: custom:mushroom-climate-card
            entity: climate.downstairs_thermostat
            name: Downstairs
          - type: custom:mushroom-climate-card
            entity: climate.upstairs_thermostat
            name: Upstairs
          - type: custom:mushroom-climate-card
            entity: climate.playroom_minisplit_setall_playroom_minisplit
            name: Playroom
          - type: custom:mushroom-climate-card
            entity: climate.gym_minisplit_setall_gym_minisplit
            name: Gym
          - type: custom:mushroom-climate-card
            entity: climate.chicken_heat_lamp
            name: Chicken Coop
          - type: custom:mushroom-climate-card
            entity: climate.study_space_heater
            name: Study Space Heater
          - type: custom:mushroom-humidifier-card
            entity: humidifier.living_room_dehumidifier
            name: Living Room Dehumidifier
          - type: custom:mushroom-humidifier-card
            entity: humidifier.dehumidifier
            name: Basement Dehumidifier
          - type: custom:mushroom-humidifier-card
            entity: humidifier.humidifier
            name: Parlor Humidifier

  # Blinds Details
  - type: grid
    cards:

      # Blinds Title
      - type: custom:mushroom-title-card
        title: "Blinds & Shades"
        subtitle: "Closed status • Reasons • Automation"
        grid_options:
          columns: full

      # Closed for Brightness
      - type: heading
        icon: mdi:white-balance-sunny
        heading: Closed for Brightness
        heading_style: subtitle
        visibility:
          - condition: state
            entity: binary_sensor.closed_brightness
            state: 'on'
      - type: custom:auto-entities
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        show_empty: false
        filter:
          template: >-
            {%- set ns = namespace(out=[]) -%}
            {%- set devices = state_attr('sensor.ui_blinds_brightness','blinds') or [] -%}
            {%- for d in devices -%}
              {%- set ns.out = ns.out + [d | combine({'type': 'custom:mushroom-template-card'})] -%}
            {%- endfor -%}
            {{ ns.out }}

      # Closed for Temperature
      - type: heading
        icon: mdi:thermometer-high
        heading: Closed for Temperature
        heading_style: subtitle
        visibility:
          - condition: state
            entity: binary_sensor.closed_temperature
            state: 'on'
      - type: custom:auto-entities
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        show_empty: false
        filter:
          template: >-
            {%- set ns = namespace(out=[]) -%}
            {%- set devices = state_attr('sensor.ui_blinds_temperature','blinds') or [] -%}
            {%- for d in devices -%}
              {%- set ns.out = ns.out + [d | combine({'type': 'custom:mushroom-template-card'})] -%}
            {%- endfor -%}
            {{ ns.out }}

      # Closed for Presence
      - type: heading
        icon: mdi:motion-sensor
        heading: Closed for Presence
        heading_style: subtitle
        visibility:
          - condition: state
            entity: binary_sensor.closed_presence
            state: 'on'
      - type: custom:auto-entities
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        show_empty: false
        filter:
          template: >-
            {%- set ns = namespace(out=[]) -%}
            {%- set devices = state_attr('sensor.ui_blinds_presence','blinds') or [] -%}
            {%- for d in devices -%}
              {%- set ns.out = ns.out + [d | combine({'type': 'custom:mushroom-template-card'})] -%}
            {%- endfor -%}
            {{ ns.out }}

      # Closed for Devices
      - type: heading
        icon: mdi:television
        heading: Closed for Devices
        heading_style: subtitle
        visibility:
          - condition: state
            entity: binary_sensor.closed_devices
            state: 'on'
      - type: custom:auto-entities
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        show_empty: false
        filter:
          template: >-
            {%- set ns = namespace(out=[]) -%}
            {%- set devices = state_attr('sensor.ui_blinds_device','blinds') or [] -%}
            {%- for d in devices -%}
              {%- set ns.out = ns.out + [d | combine({'type': 'custom:mushroom-template-card'})] -%}
            {%- endfor -%}
            {{ ns.out }}

      # Closed by Button
      - type: heading
        icon: mdi:gesture-tap-button
        heading: Closed by Button
        heading_style: subtitle
        visibility:
          - condition: state
            entity: binary_sensor.closed_button
            state: 'on'
      - type: custom:auto-entities
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        show_empty: false
        filter:
          template: >-
            {%- set ns = namespace(out=[]) -%}
            {%- set devices = state_attr('sensor.ui_blinds_button','blinds') or [] -%}
            {%- for d in devices -%}
              {%- set ns.out = ns.out + [d | combine({'type': 'custom:mushroom-template-card'})] -%}
            {%- endfor -%}
            {{ ns.out }}

      # Closed by Nighttime
      - type: heading
        icon: mdi:gesture-tap-button
        heading: Closed by Nighttime
        heading_style: subtitle
        visibility:
          - condition: state
            entity: binary_sensor.closed_nighttime
            state: 'on'
      - type: custom:auto-entities
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        show_empty: false
        filter:
          template: >-
            {%- set ns = namespace(out=[]) -%}
            {%- set devices = state_attr('sensor.ui_blinds_nighttime','blinds') or [] -%}
            {%- for d in devices -%}
              {%- set ns.out = ns.out + [d | combine({'type': 'custom:mushroom-template-card'})] -%}
            {%- endfor -%}
            {{ ns.out }}
