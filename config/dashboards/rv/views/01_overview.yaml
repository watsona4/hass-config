# =========================
# 1) OVERVIEW
# =========================
title: Overview
icon: mdi:rv-truck
path: overview
type: masonry
badges:
  - type: custom:mushroom-template-badge
    entity: sensor.rv_inside_temperature
    icon: mdi:thermometer
    color: >-
      {% set t = states(entity) | float(999) %}
      {{ 'blue' if t < 60 else 'green' if t < 75 else 'amber' if t < 85 else 'red' }}
    content: >-
      {{ 'Temp: ' ~ states(entity) | round(0) ~ '°F in · ' ~ states('sensor.rv_outside_temperature') | round(0) ~ '°F out' }}
    tap_action:
      action: navigate
      navigation_path: /lovelace-rv/climate
    hold_action:
      action: more-info
  - type: custom:mushroom-template-badge
    entity: sensor.rv_status_summary
    icon: >-
      {{ 'mdi:power-plug' if state_attr(entity,'shore_power') else 'mdi:solar-power-variant' }}
    color: >-
      {{ 'green' if state_attr(entity,'shore_power') else 'teal' }}
    content: >-
      {{ ('Shore' if state_attr(entity,'shore_power') else 'Battery') ~ ': ' ~ state_attr(entity,'dc_voltage') | round(1) ~ ' V' }}
    tap_action:
      action: navigate
      navigation_path: /lovelace-rv/electrical
    hold_action:
      action: more-info
  - type: custom:mushroom-template-badge
    entity: sensor.rv_battery_soc
    icon: >-
      {% set soc = states(entity) | int(0) %}
      {{ 'mdi:battery-high' if soc > 80 else 'mdi:battery-medium' if soc > 40 else 'mdi:battery-low' if soc > 15 else 'mdi:battery-outline' }}
    color: >-
      {% set soc = states(entity) | int(0) %}
      {{ 'green' if soc > 80 else 'amber' if soc > 40 else 'orange' if soc > 15 else 'red' }}
    content: "{{ 'Battery Charge: ' ~ states(entity) | round(0) ~ '%' }}"
    tap_action:
      action: navigate
      navigation_path: /lovelace-rv/electrical
    hold_action:
      action: more-info
  - type: custom:mushroom-template-badge
    entity: sensor.rv_status_summary
    icon: mdi:water
    color: >-
      {% set f = state_attr(entity,'tank_fresh_pct') | int(0) %}
      {{ 'blue' if f > 75 else 'teal' if f > 40 else 'amber' if f > 15 else 'red' }}
    content: >-
      {% set f = state_attr(entity,'tank_fresh_pct') | int(0) %}
      {% set g = state_attr(entity,'tank_gray_pct') | int(0) %}
      {% set b = state_attr(entity,'tank_black_pct') | int(0) %}
      {{ 'Fresh: ' ~ f ~ '% · Gray: ' ~ g ~ '% · Black: ' ~ b ~ '%' }}
    tap_action:
      action: navigate
      navigation_path: /lovelace-rv/tanks
    hold_action:
      action: more-info
  - type: custom:mushroom-template-badge
    entity: sensor.rv_propane_pct
    icon: mdi:gas-cylinder
    color: >-
      {% set lp = states(entity) | int(0) %}
      {{ 'green' if lp > 60 else 'amber' if lp > 30 else 'orange' if lp > 15 else 'red' }}
    content: "{{ 'Propane: ' ~ states(entity) | int(0) ~ '%' }}"
    tap_action:
      action: navigate
      navigation_path: /lovelace-rv/tanks
    hold_action:
      action: more-info
  - type: custom:mushroom-template-badge
    entity: device_tracker.rv_gps
    icon: mdi:map-marker
    color: purple
    content: >-
      {% set lat = state_attr(entity,'latitude') | float(none) | round(2) %}
      {% set lon = state_attr(entity,'longitude') | float(none) | round(2) %}
      {% set alat = lat if lat >= 0 else -lat %}
      {% set alon = lon if lon >= 0 else -lon %}
      {% set dlat = 'N' if lat >= 0 else 'S' %}
      {% set dlon = 'E' if lon >= 0 else 'W' %}
      {{ 'GPS: ' ~ alat ~ '°' ~ dlat ~ ', ' ~ alon ~ '°' ~ dlon ~ ' · ' ~ states(entity) }}
    tap_action:
      action: navigate
      navigation_path: /lovelace-rv/location
    hold_action:
      action: more-info
cards:

  # Map centered on RV
  - type: map
    entities:
      - entity: device_tracker.rv_gps_map
    default_zoom: 12
    auto_fit: true
    hours_to_show: 12

  # Today at a glance
  - type: vertical-stack
    cards:
      - type: custom:mushroom-title-card
        title: Power summary
      - type: grid
        columns: 2
        square: false
        cards:
          - type: custom:mushroom-template-card
            entity: sensor.rv_battery_soc
            primary: "{{ states(entity) | round(0) }}%"
            secondary: Battery
            icon: >-
              {% set soc = states(entity) | int(0) %}
              {{ 'mdi:battery-high' if soc > 80 else 'mdi:battery-medium' if soc > 40 else 'mdi:battery-low' if soc > 15 else 'mdi:battery-outline' }}
            icon_color: >-
              {% set soc = states(entity) | int(0) %}
              {{ 'green' if soc > 80 else 'amber' if soc > 40 else 'orange' if soc > 15 else 'red' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_battery_voltage
            primary: "{{ states(entity) | float(0) | round(1) }} V"
            secondary: 12 V bus
            icon: mdi:car-battery
            icon_color: >-
              {% set v = states(entity) | float(0) %}
              {{ 'red' if v < 11.8 else 'amber' if v < 12.2 else 'green' if v <= 13.0 else 'blue' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_dc_current
            primary: "{% set a = states(entity) | float(0) %} {{ a | round(1) }} A"
            secondary: DC current
            icon: mdi:current-dc
            icon_color: >-
              {% set a = states(entity) | float(0) %}
              {{ 'teal' if a < 0 else 'purple' if a > 0 else 'grey' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_ac_input_amps
            primary: "{{ states(entity) | float(0) | round(1) }} A"
            secondary: AC shore draw
            icon: mdi:transmission-tower
            icon_color: >-
              {% set a = states(entity) | float(0) %}
              {{ 'green' if a <= 2 else 'amber' if a <= 10 else 'red' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_solar_watts
            primary: >-
              {% set w = states(entity) | float(0) %}
              {{ (w/1000) | round(2) ~ ' kW' if w >= 1000 else w | round(0) ~ ' W' }}
            secondary: Solar
            icon: mdi:solar-power-variant
            icon_color: >-
              {% set w = states(entity) | float(0) %}
               'teal' if w < 300 else 'green' }}
            tap_action:
              action: more-info
      - type: custom:mushroom-title-card
        title: Tanks summary
      - type: grid
        columns: 2
        square: false
        cards:
          - type: custom:mushroom-template-card
            entity: sensor.rv_fresh_tank
            primary: "{{ states(entity) | int(0) }}%"
            secondary: Fresh
            icon: mdi:water
            icon_color: >-
              {% set v = states(entity) | int(0) %}
              {{ 'blue' if v > 75 else 'teal' if v > 40 else 'amber' if v > 15 else 'red' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_gray_tank
            primary: "{{ states(entity) | int(0) }}%"
            secondary: Gray
            icon: mdi:water-percent
            icon_color: >-
              {% set v = states(entity) | int(0) %}
              {{ 'green' if v < 50 else 'amber' if v < 80 else 'red' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_black_tank
            primary: "{{ states(entity) | int(0) }}%"
            secondary: Black
            icon: mdi:toilet
            icon_color: >-
              {% set v = states(entity) | int(0) %}
              {{ 'green' if v < 50 else 'amber' if v < 85 else 'red' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_propane_left
            primary: "{{ states(entity) | int(0) }}%"
            secondary: Propane L
            icon: mdi:gas-cylinder
            icon_color: >-
              {% set v = states(entity) | int(0) %}
              {{ 'green' if v > 60 else 'amber' if v > 30 else 'orange' if v > 15 else 'red' }}
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.rv_propane_right
            primary: "{{ states(entity) | int(0) }}%"
            secondary: Propane R
            icon: mdi:gas-cylinder
            icon_color: >-
              {% set v = states(entity) | int(0) %}
              {{ 'green' if v > 60 else 'amber' if v > 30 else 'orange' if v > 15 else 'red' }}
            tap_action:
              action: more-info
