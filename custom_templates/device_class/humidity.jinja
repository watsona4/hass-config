{#- Severity definitions for humidity measurements (HA device_class: humidity) -#}

{% from 'helpers.jinja' import find_matching_level, humanize_unit, format_name %}

{#- Humidity levels for various applications -#}
{% set levels = {
    "indoor": [
        {
            "min_value": 0,
            "default_desc": "Extremely Dry",
            "short_desc": "Ext Dry",
            "long_desc": "Extremely Dry Air",
            "icon": "mdi:water-off",
            "color": "#a16207",
            "full_desc": "Extremely dry conditions, high static and skin irritation risk; consider a humidifier."
        },
        {
            "min_value": 10,
            "default_desc": "Very Dry",
            "short_desc": "Very Dry",
            "long_desc": "Very Dry Air",
            "icon": "mdi:water-outline",
            "color": "#d97706",
            "full_desc": "Very dry; add moisture, especially for wood instruments or plants."
        },
        {
            "min_value": 20,
            "default_desc": "Dry",
            "short_desc": "Dry",
            "long_desc": "Dry Air",
            "icon": "mdi:water-percent",
            "color": "#f59e0b",
            "full_desc": "Dry; many will notice dry skin and lips."
        },
        {
            "min_value": 30,
            "default_desc": "Low Humidity",
            "short_desc": "Low RH",
            "long_desc": "Low Humidity",
            "icon": "mdi:water-check",
            "color": "#84cc16",
            "full_desc": "Low humidity; still a bit dry for comfort."
        },
        {
            "min_value": 40,
            "default_desc": "Comfort",
            "short_desc": "Comfort",
            "long_desc": "Comfort Range",
            "icon": "mdi:water",
            "color": "#10b981",
            "full_desc": "Comfort range for most homes and electronics."
        },
        {
            "min_value": 50,
            "default_desc": "Moderately Humid",
            "short_desc": "Mod Humid",
            "long_desc": "Moderately Humid Air",
            "icon": "mdi:water-percent",
            "color": "#2dd4bf",
            "full_desc": "Slightly muggy; ventilate or dehumidify if needed."
        },
        {
            "min_value": 60,
            "default_desc": "Humid",
            "short_desc": "Humid",
            "long_desc": "Humid Air",
            "icon": "mdi:water-alert",
            "color": "#60a5fa",
            "full_desc": "Humid; increase ventilation and consider dehumidification."
        },
        {
            "min_value": 70,
            "default_desc": "Very Humid",
            "short_desc": "V Humid",
            "long_desc": "Very Humid Air",
            "icon": "mdi:weather-pouring",
            "color": "#3b82f6",
            "full_desc": "Very humid; mold and dust mites thrive, dehumidify aggressively."
        },
        {
            "min_value": 80,
            "default_desc": "Oppressive",
            "short_desc": "Oppress",
            "long_desc": "Oppressive Humidity",
            "icon": "mdi:waves",
            "color": "#7c3aed",
            "full_desc": "Oppressive humidity; strong dehumidification and air conditioning recommended."
        }
    ],

    "outdoor": [
        {
            "min_value": 0,
            "default_desc": "Arid",
            "short_desc": "Arid",
            "long_desc": "Arid Outdoor Air",
            "icon": "mdi:weather-sunny",
            "color": "#ca8a04",
            "full_desc": "Very dry outdoor air; increased risk of wildfires and dehydration."
        },
        {
            "min_value": 30,
            "default_desc": "Comfort",
            "short_desc": "Comfort",
            "long_desc": "Comfortable Outdoor Humidity",
            "icon": "mdi:weather-cloudy",
            "color": "#10b981",
            "full_desc": "Pleasant humidity for most activities."
        },
        {
            "min_value": 60,
            "default_desc": "Humid",
            "short_desc": "Humid",
            "long_desc": "Humid Outdoor Air",
            "icon": "mdi:weather-partly-rainy",
            "color": "#3b82f6",
            "full_desc": "Humid conditions; sweating less effective, hydrate often."
        },
        {
            "min_value": 80,
            "default_desc": "Oppressive",
            "short_desc": "Oppress",
            "long_desc": "Oppressive Outdoor Humidity",
            "icon": "mdi:weather-tropical-storm",
            "color": "#7c3aed",
            "full_desc": "Dangerous humidity; heat stress likely, avoid strenuous activity."
        }
    ],

    "greenhouse": [
        {
            "min_value": 0,
            "default_desc": "Too Dry",
            "short_desc": "Dry",
            "long_desc": "Greenhouse Too Dry",
            "icon": "mdi:leaf-off",
            "color": "#ca8a04",
            "full_desc": "Plants may wilt; mist or water frequently."
        },
        {
            "min_value": 40,
            "default_desc": "Growth Range",
            "short_desc": "Growth",
            "long_desc": "Optimal Plant Growth",
            "icon": "mdi:leaf",
            "color": "#16a34a",
            "full_desc": "Ideal humidity for most greenhouse plants."
        },
        {
            "min_value": 70,
            "default_desc": "High RH",
            "short_desc": "High RH",
            "long_desc": "High Greenhouse Humidity",
            "icon": "mdi:sprout",
            "color": "#3b82f6",
            "full_desc": "Humidity high; risk of fungal diseases, ventilate greenhouse."
        },
        {
            "min_value": 85,
            "default_desc": "Excessive",
            "short_desc": "Excess",
            "long_desc": "Excessive Greenhouse Humidity",
            "icon": "mdi:mushroom",
            "color": "#9333ea",
            "full_desc": "Too humid; mold, mildew, and rot likely without intervention."
        }
    ],

    "basement": [
        {
            "min_value": 0,
            "default_desc": "Dry",
            "short_desc": "Dry",
            "long_desc": "Dry Basement",
            "icon": "mdi:water-off",
            "color": "#a16207",
            "full_desc": "Basement air is very dry; usually safe, but may cause wood shrinkage."
        },
        {
            "min_value": 50,
            "default_desc": "Comfort",
            "short_desc": "Comfort",
            "long_desc": "Comfortable Basement RH",
            "icon": "mdi:water-check",
            "color": "#10b981",
            "full_desc": "Safe humidity for storage and preventing mold."
        },
        {
            "min_value": 60,
            "default_desc": "Humid",
            "short_desc": "Humid",
            "long_desc": "Humid Basement",
            "icon": "mdi:water-alert",
            "color": "#3b82f6",
            "full_desc": "Humidity creeping up; risk of mold growth, consider dehumidifier."
        },
        {
            "min_value": 70,
            "default_desc": "Damp",
            "short_desc": "Damp",
            "long_desc": "Damp Basement",
            "icon": "mdi:home-flood",
            "color": "#2563eb",
            "full_desc": "High humidity; mold and mildew thrive, dehumidification strongly needed."
        },
        {
            "min_value": 80,
            "default_desc": "Wet",
            "short_desc": "Wet",
            "long_desc": "Wet Basement Conditions",
            "icon": "mdi:home-alert",
            "color": "#7c3aed",
            "full_desc": "Extremely high RH; risk of structural damage, rot, and persistent mold."
        }
    ]
} %}

{#- Helper macro for common level retrieval pattern -#}
{% macro _get_level_attrs(value, app, attr) %}
    {%- if app not in levels -%}
        {{- 'Error: Unknown application: ' ~ app -}}
    {%- else -%}
        {%- set match = find_matching_level(value, levels[app]) | from_json -%}
        {{- match[attr] -}}
    {%- endif -%}
{% endmacro %}

{#- Standard wrapper functions -#}
{% macro get_value(value, options={}) %}
    {{- humanize_unit(value, options.get('from_unit')) -}}
{% endmacro %}

{% macro get_name(value, app, options={}) %}
    {{- format_name(options.get('friendly_name')) -}}
{% endmacro %}

{% macro get_default_desc(value, app, options={}) %}
    {{- _get_level_attrs(value, app, 'default_desc') -}}
{% endmacro %}

{% macro get_short_desc(value, app, options={}) %}
    {{- _get_level_attrs(value, app, 'short_desc') -}}
{% endmacro %}

{% macro get_long_desc(value, app, options={}) %}
    {{- _get_level_attrs(value, app, 'long_desc') -}}
{% endmacro %}

{% macro get_icon(value, app, options={}) %}
    {{- _get_level_attrs(value, app, 'icon') -}}
{% endmacro %}

{% macro get_full_desc(value, app, options={}) %}
    {{- _get_level_attrs(value, app, 'full_desc') -}}
{% endmacro %}

{% macro get_color(value, app, options={}) %}
    {{- _get_level_attrs(value, app, 'color') -}}
{% endmacro %}
