{#- Severity definitions for illuminance measurements (HA device_class: illuminance) -#}

{% from 'helpers.jinja' import find_matching_level, humanize_unit, format_name %}
{% from 'units/base.jinja' import u_convert_value %}

{#- Illuminance levels for various applications -#}
{% set lookup_unit = 'lx' %}
{%- set levels = {
  "indoor": [
    {
      "min_value": 0,
      "default_desc": "Dark",
      "short_desc": "Dark",
      "long_desc": "Dark or Nighttime",
      "icon": "mdi:weather-night",
      "color": "#0f172a",
      "full_desc": "Very little light; unsafe for reading or detailed tasks."
    },
    {
      "min_value": 50,
      "default_desc": "Dim",
      "short_desc": "Dim",
      "long_desc": "Dimly Lit Room",
      "icon": "mdi:lightbulb-outline",
      "color": "#713f12",
      "full_desc": "Dim; suitable for ambiance but not reading."
    },
    {
      "min_value": 200,
      "default_desc": "Living",
      "short_desc": "Living",
      "long_desc": "General Living Light",
      "icon": "mdi:sofa",
      "color": "#f59e0b",
      "full_desc": "Comfortable lighting for most indoor activities."
    },
    {
      "min_value": 500,
      "default_desc": "Bright",
      "short_desc": "Bright",
      "long_desc": "Bright Indoor Light",
      "icon": "mdi:lightbulb-on",
      "color": "#10b981",
      "full_desc": "Bright light, suitable for reading or working."
    },
    {
      "min_value": 1000,
      "default_desc": "Very Bright",
      "short_desc": "V Bright",
      "long_desc": "Very Bright Indoor",
      "icon": "mdi:spotlight-beam",
      "color": "#3b82f6",
      "full_desc": "Strong indoor lighting; can cause glare."
    }
  ],

  "outdoor": [
    {
      "min_value": 0,
      "default_desc": "Night",
      "short_desc": "Night",
      "long_desc": "Night Sky",
      "icon": "mdi:weather-night",
      "color": "#0f172a",
      "full_desc": "No sunlight; starlight or artificial light only."
    },
    {
      "min_value": 1,
      "default_desc": "Twilight",
      "short_desc": "Twilight",
      "long_desc": "Twilight/Dawn",
      "icon": "mdi:weather-sunset",
      "color": "#9333ea",
      "full_desc": "Very low natural light; outlines visible."
    },
    {
      "min_value": 100,
      "default_desc": "Overcast",
      "short_desc": "Overcast",
      "long_desc": "Overcast Daylight",
      "icon": "mdi:weather-cloudy",
      "color": "#60a5fa",
      "full_desc": "Dark cloudy day; feels dim but safe outdoors."
    },
    {
      "min_value": 10000,
      "default_desc": "Daylight",
      "short_desc": "Daylight",
      "long_desc": "Full Daylight",
      "icon": "mdi:weather-sunny",
      "color": "#facc15",
      "full_desc": "Typical daylight outdoors, even with some cloud cover."
    },
    {
      "min_value": 30000,
      "default_desc": "Bright Sun",
      "short_desc": "B Sun",
      "long_desc": "Bright Sunlight",
      "icon": "mdi:white-balance-sunny",
      "color": "#f59e0b",
      "full_desc": "Bright, direct sun; can cause eye strain."
    },
    {
      "min_value": 100000,
      "default_desc": "Extreme Sun",
      "short_desc": "Extreme",
      "long_desc": "Extreme Sunlight",
      "icon": "mdi:sunglasses",
      "color": "#e11d48",
      "full_desc": "Peak direct sun at noon on clear days; protective eyewear recommended."
    }
  ],

  "workshop": [
    {
      "min_value": 0,
      "default_desc": "Dark",
      "short_desc": "Dark",
      "long_desc": "No Workshop Light",
      "icon": "mdi:flash-off",
      "color": "#0f172a",
      "full_desc": "No lighting; unsafe for any work."
    },
    {
      "min_value": 200,
      "default_desc": "Minimal Task",
      "short_desc": "Minimal",
      "long_desc": "Minimal Task Lighting",
      "icon": "mdi:desk-lamp",
      "color": "#d97706",
      "full_desc": "Enough light for simple, low-precision tasks."
    },
    {
      "min_value": 500,
      "default_desc": "General Work",
      "short_desc": "Work",
      "long_desc": "General Workshop Lighting",
      "icon": "mdi:hammer-screwdriver",
      "color": "#22c55e",
      "full_desc": "Adequate for woodworking, repairs, and most shop tasks."
    },
    {
      "min_value": 1000,
      "default_desc": "Detail Work",
      "short_desc": "Detail",
      "long_desc": "Detail Workshop Lighting",
      "icon": "mdi:magnify",
      "color": "#3b82f6",
      "full_desc": "Bright lighting for detailed or precision work."
    },
    {
      "min_value": 2000,
      "default_desc": "Fine Detail",
      "short_desc": "Fine",
      "long_desc": "Fine Detail Lighting",
      "icon": "mdi:spotlight-beam",
      "color": "#9333ea",
      "full_desc": "Very bright lighting; ideal for electronics, painting, or inspection tasks."
    }
  ]
} -%}

{#- Helper macro for common temperature level retrieval pattern -#}
{% macro _get_level_attrs(value, app, attr, options) %}
    {%- if app not in levels -%}
        {{- 'Error: Unknown application: ' ~ app -}}
    {%- else -%}
        {%- set lookup = u_convert_value(value, options.uom, lookup_unit) -%}
        {%- set match = find_matching_level(lookup, levels[app]) | from_json -%}
        {{- match[attr] -}}
    {%- endif -%}
{% endmacro %}

{#- Standard wrapper functions -#}
{% macro get_value(value, options) %}
    {%- set temp = u_convert_value(value, options.uom, options.display_unit) -%}
    {{- humanize_unit(temp, options.display_unit) -}}
{% endmacro %}

{% macro get_name(value, app, options) %}
    {%- set friendly_name = options.friendly_name -%}
    {{- format_name(friendly_name) -}}
{% endmacro %}

{% macro get_default_desc(value, app, options) %}
    {{- _get_level_attrs(value, app, 'default_desc', options) -}}
{% endmacro %}

{% macro get_short_desc(value, app, options) %}
    {{- _get_level_attrs(value, app, 'short_desc', options) -}}
{% endmacro %}

{% macro get_long_desc(value, app, options) %}
    {{- _get_level_attrs(value, app, 'long_desc', options) -}}
{% endmacro %}

{% macro get_icon(value, app, options) %}
    {{- _get_level_attrs(value, app, 'icon', options) -}}
{% endmacro %}

{% macro get_full_desc(value, app, options) %}
    {{- _get_level_attrs(value, app, 'full_desc', options) -}}
{% endmacro %}

{% macro get_color(value, app, options) %}
    {{- _get_level_attrs(value, app, 'color', options) -}}
{% endmacro %}

{% macro get_badge(value, app, options) %}{% endmacro %}

{% macro get_label(value, app, options) %}{% endmacro %}

{% macro get_short_label(value, app, options) %}{% endmacro %}

{% macro get_long_label(value, app, options) %}{% endmacro %}
