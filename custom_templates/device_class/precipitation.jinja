{# Severity definitions for precipitation measurements (HA device_class: precipitation) #}

{% import 'helpers.jinja' as H with context %}
{% from 'units/base.jinja' import u_convert_entity %}

{# Precipitation levels based on accumulation in mm #}
{% set lookup_unit = 'mm' %}
{% set levels = {
    "default": [
        {
            "min_value": 0,
            "default_desc": "Dry",
            "short_desc": "Dry",
            "long_desc": "No measurable precipitation expected",
            "icon": "mdi:weather-sunny",
            "color": "#facc15",
            "full_desc": "Dry conditions expected through the day."
        },
        {
            "min_value": 1,
            "default_desc": "Light",
            "short_desc": "Light",
            "long_desc": "Spotty or brief precipitation",
            "icon": "mdi:weather-partly-rainy",
            "color": "#22c55e",
            "full_desc": "Intermittent or gentle precipitation likely."
        },
        {
            "min_value": 5,
            "default_desc": "Moderate",
            "short_desc": "Mod",
            "long_desc": "Widespread steady precipitation",
            "icon": "mdi:weather-rainy",
            "color": "#3b82f6",
            "full_desc": "A sustained period of precipitation is likely."
        },
        {
            "min_value": 15,
            "default_desc": "Heavy",
            "short_desc": "Heavy",
            "long_desc": "Prolonged or intense precipitation",
            "icon": "mdi:weather-pouring",
            "color": "#2563eb",
            "full_desc": "Strong, long-lasting precipitation likely."
        },
        {
            "min_value": 30,
            "default_desc": "Very Heavy",
            "short_desc": "V Heavy",
            "long_desc": "Very wet day with significant impacts",
            "icon": "mdi:weather-lightning-rainy",
            "color": "#1e3a8a",
            "full_desc": "High impact day with saturated surfaces likely."
        },
        {
            "min_value": 50,
            "default_desc": "Extreme",
            "short_desc": "Extreme",
            "long_desc": "Exceptional precipitation event",
            "icon": "mdi:weather-hurricane",
            "color": "#581c87",
            "full_desc": "Dangerous conditions possible; monitor warnings."
        }
    ]
} %}

{% macro get_dc_context() %}{{- {'lookup_unit': lookup_unit, 'levels': levels} | tojson -}}{% endmacro %}

{% macro get_name(value, app, options) -%}
    {{- 'Precipitation â€¢ ' ~ H.get_default_desc(value, app, options) -}}
{%- endmacro %}

{% macro get_label(value, app, options) %}
    {%- if has_value(options.prob) -%}
        {%- set prob = states(options.prob) -%}
        {{- prob ~ '% chance: ' ~ H.get_value(value, options) -}}
    {%- endif -%}
{% endmacro %}

{% macro get_short_label(value, app, options) %}
    {{- get_label(value, app, options) -}}
{% endmacro %}

{% macro get_long_label(value, app, options) %}
    {{- get_label(value, app, options) -}}
{% endmacro %}
