{# # File: config/custom_templates/house_water_pressure.jinja ## #}
{# House water pressure (psi) with PRV guidance #}

{% from 'helpers.jinja' import level_find %}

{# Breakpoints (psi): 0–20 Very Low • 20–40 Low • 40–60 Optimal • 60–80 High • 80–100 Very High • 100+ Dangerous #}
{% set bps = [0, 20, 40, 60, 80, 100] %}

{% set names = ["Very Low","Low","Optimal","High","Very High","Dangerous"] %}
{% set shorts = ["V Low","Low","Opt","High","V High","Danger"] %}
{% set longs  = [
  "Pressure: Very Low","Pressure: Low","Pressure: Optimal","Pressure: High","Pressure: Very High","Pressure: Dangerous"
] %}
{% set icons  = ["mdi:water-off","mdi:water-outline","mdi:water-check","mdi:water","mdi:water-alert","mdi:alert-decagram"] %}
{% set colors = ["#ef4444","#f59e0b","#22c55e","#eab308","#f97316","#7c3aed","disabled"] %}
{% set descs  = [
  "Fixtures may sputter; check main valve/municipal supply.",
  "Borderline; showers weak—consider booster.",
  "Healthy pressure for most homes (~50–60 psi).",
  "High—watch for water hammer; consider PRV tuning.",
  "Very high—stress on plumbing/appliances.",
  "Unsafe—install/adjust PRV and add expansion tank."
] %}

{% macro level(psi) -%}{{ level_find((psi|float), bps) }}{%- endmacro %}
{% macro name(psi) -%}{{ names[level(psi)|int-1] }}{%- endmacro %}
{% macro short(psi) -%}{{ shorts[level(psi)|int-1] }}{%- endmacro %}
{% macro long(psi) -%}{{ longs[level(psi)|int-1] }}{%- endmacro %}
{% macro icon(psi) -%}{{ icons[level(psi)|int-1] }}{%- endmacro %}
{% macro color(psi) -%}{{ colors[level(psi)|int-1] }}{%- endmacro %}
{% macro desc(psi) -%}{{ descs[level(psi)|int-1] }}{%- endmacro %}

{% macro bars(psi) -%}
  {%- set p = psi|float -%}
  {%- if p < 15 -%}0{% elif p < 35 -%}1{% elif p < 55 -%}2{% elif p < 75 -%}3{% else -%}4{% endif -%}
{%- endmacro %}

{% macro label(psi) -%}{{ name(psi) }} • {{ (psi|float)|round(0) }} psi{%- endmacro %}
{% macro advice(psi) -%}
  {%- set p = psi|float -%}
  {%- if p < 40 -%}Increase PRV/booster; check clogged strainers.
  {%- elif p <= 60 -%}All good.
  {%- elif p <= 80 -%}Dial PRV to ~55–60 psi; add arrestors if hammering.
  {%- else -%}Install/adjust PRV; add expansion tank & check TPR valves.
  {%- endif -%}
{%- endmacro %}
