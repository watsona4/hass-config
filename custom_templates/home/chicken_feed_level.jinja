{# # File: config/custom_templates/chicken_feed_level.jinja ## #}
{# Chicken feed: hopper/bin fill, days remaining, reorder hints #}

{% from 'helpers.jinja' import level_find %}

{% set bps = [0, 10, 25, 50, 75, 90, 100] %}
{% set names = ["Empty","Very Low","Low","Half","High","Very High","Full"] %}
{% set icons = ["mdi:silo","mdi:silo","mdi:silo","mdi:silo","mdi:silo","mdi:silo","mdi:silo"] %}
{% set colors = ["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#10b981","#10b981","disabled"] %}
{% set descs = [
      "Out of feed.",
        "Top up ASAP.",
          "Running low—plan refill.",
            "Half full.",
              "Healthy level.",
                "Nearly full.",
                  "Full."
] %}

{% macro level(pct) -%}{{ level_find((pct|float), bps) }}{%- endmacro %}
{% macro name(pct) -%}{{ names[level(pct)|int-1] }}{%- endmacro %}
{% macro icon(pct) -%}{{ icons[level(pct)|int-1] }}{%- endmacro %}
{% macro color(pct) -%}{{ colors[level(pct)|int-1] }}{%- endmacro %}
{% macro desc(pct) -%}{{ descs[level(pct)|int-1] }}{%- endmacro %}
{% macro label(pct) -%}{{ name(pct) }} • {{ (pct|float)|round(0) }}%{%- endmacro %}

{# capacity_lb = bin capacity, daily_lb = flock daily consumption #}
{% macro days_remaining(pct, capacity_lb, daily_lb) -%}
  {%- set avail = (pct|float/100.0) * (capacity_lb|float) -%}
    {{ (avail / (daily_lb|float if daily_lb else 1.0)) }}
    {%- endmacro %}

    {% macro reorder_label(pct, capacity_lb, daily_lb, threshold_days=3) -%}
      {%- set d = days_remaining(pct, capacity_lb, daily_lb)|float -%}
        {{ (d|round(1)) }} days left{{ ' • reorder now' if d <= (threshold_days|float) else '' }}
        {%- endmacro %}
]}