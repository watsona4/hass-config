{# # File: config/custom_templates/smoker_temp_humidity.jinja ## #}
{# Smoker chamber temperature & humidity #}

{% from 'helpers.jinja' import level_find, convert_temp_value %}

{% macro to_f(t, unit='f') -%}{{ convert_temp_value(t, unit, 'f') }}{%- endmacro %}

{# Profiles: 'low_slow' (target ~225°F), 'hot_smoke' (~325°F) #}
{% set bps_low =  [100, 180, 210, 240, 275, 325] %}
{% set bps_hot =  [150, 275, 300, 350, 400, 450] %}

{% set names = ["Too Low","Low","Optimal","Hot","Very Hot","Way Hot"] %}
{% set icons = ["mdi:fire-off","mdi:fire","mdi:fire-check","mdi:fire","mdi:fire-alert","mdi:alert-decagram"] %}
{% set colors= ["#60a5fa","#eab308","#22c55e","#f59e0b","#f97316","#ef4444","disabled"] %}

{% macro t_level(t, profile='low_slow', unit='f') -%}
  {%- set F = to_f(t, unit)|float -%}
    {%- if (profile|string|lower) in ['hot','hot_smoke'] -%}{{ level_find(F, bps_hot) }}
      {%- else -%}{{ level_find(F, bps_low) }}{%- endif -%}
      {%- endmacro %}
      {% macro t_name(t, profile='low_slow', unit='f') -%}{{ names[t_level(t,profile,unit)|int-1] }}{%- endmacro %}
      {% macro t_icon(t, profile='low_slow', unit='f') -%}{{ icons[t_level(t,profile,unit)|int-1] }}{%- endmacro %}
      {% macro t_color(t, profile='low_slow', unit='f') -%}{{ colors[t_level(t,profile,unit)|int-1] }}{%- endmacro %}

      {# Humidity buckets (%) for smoking: 40–70% good #}
      {% set bps_rh = [0, 30, 40, 70, 85, 100] %}
      {% set rh_names = ["Very Dry","Dry","Good","Humid","Wet","Saturated"] %}
      {% macro rh_level(rh) -%}{{ level_find((rh|float), bps_rh) }}{%- endmacro %}
      {% macro rh_name(rh) -%}{{ rh_names[rh_level(rh)|int-1] }}{%- endmacro %}

      {% macro label(t, rh=None, profile='low_slow', unit='f') -%}
        {{ t_name(t,profile,unit) }} • {{ (to_f(t,unit)|round(0)) }}°F{{ ' • RH ' ~ (rh|float)|round(0) ~ '% (' ~ rh_name(rh) ~ ')' if rh is not none else '' }}
        {%- endmacro %}