{# # File: config/custom_templates/chicken_water_barrel.jinja ## #}
{# Chicken water barrel: fill % and water temperature comfort #}

{% from 'helpers.jinja' import level_find, convert_temp_value %}

{# -------- Fill level (percent) -------- #}
{% set bps_fill = [0, 10, 25, 50, 75, 90, 100] %}
{% set fill_names = ["Empty","Very Low","Low","Half","High","Very High","Full"] %}
{% set fill_icons = ["mdi:cup-off","mdi:cup-outline","mdi:cup","mdi:cup","mdi:cup","mdi:cup-water","mdi:cup-water"] %}
{% set fill_colors = ["#ef4444","#f97316","#eab308","#84cc16","#22c55e","#10b981","#10b981","disabled"] %}
{% macro fill_level(pct) -%}{{ level_find((pct|float), bps_fill) }}{%- endmacro %}
{% macro fill_name(pct) -%}{{ fill_names[fill_level(pct)|int-1] }}{%- endmacro %}
{% macro fill_icon(pct) -%}{{ fill_icons[fill_level(pct)|int-1] }}{%- endmacro %}
{% macro fill_color(pct) -%}{{ fill_colors[fill_level(pct)|int-1] }}{%- endmacro %}
{% macro fill_label(pct) -%}{{ fill_name(pct) }} • {{ (pct|float)|round(0) }}%{%- endmacro %}

{# -------- Water temperature (defaults °F). Poultry comfort ~50–70°F (10–21°C) -------- #}
{% macro to_c(t, unit='f') -%}{{ convert_temp_value(t, unit, 'c') }}{%- endmacro %}
{% set bps_temp_c = [ -2, 1, 10, 21, 27, 32 ] %}
{% set temp_names = ["Freezing Risk","Cold","Comfort","Warm","Hot","Too Hot"] %}
{% set temp_icons = ["mdi:snowflake","mdi:thermometer-low","mdi:thermometer-check","mdi:thermometer","mdi:thermometer-high","mdi:fire"] %}
{% set temp_colors = ["#3b82f6","#60a5fa","#22c55e","#eab308","#f97316","#ef4444","disabled"] %}
{% set temp_descs = [
      "May freeze—insulate or add heater.",
        "Cold; intake may drop.",
          "Comfortable for chickens.",
            "Warm; encourage shade and fresh refills.",
              "Hot; intake drops—cool water needed.",
                "Too hot—risk of heat stress."
] %}
{% macro temp_level(t, unit='f') -%}{{ level_find(to_c(t, unit)|float, bps_temp_c) }}{%- endmacro %}
{% macro temp_name(t, unit='f') -%}{{ temp_names[temp_level(t, unit)|int-1] }}{%- endmacro %}
{% macro temp_icon(t, unit='f') -%}{{ temp_icons[temp_level(t, unit)|int-1] }}{%- endmacro %}
{% macro temp_color(t, unit='f') -%}{{ temp_colors[temp_level(t, unit)|int-1] }}{%- endmacro %}
{% macro temp_desc(t, unit='f') -%}{{ temp_descs[temp_level(t, unit)|int-1] }}{%- endmacro %}

{# -------- Combined labels -------- #}
{% macro label(pct, t, unit='f') -%}
  {{ fill_label(pct) }} • {{ temp_name(t, unit) }} • {{ (convert_temp_value(t, unit, 'f')|round(0)) }}°F
  {%- endmacro %}
  {% macro advice(pct, t, unit='f') -%}
    {%- set L = temp_level(t, unit)|int -%}
      {%- if pct|float <= 25 -%}Refill soon. {% endif -%}
        {%- if L == 1 -%}Prevent freezing (heater/insulation).
          {%- elif L == 2 -%}Offer slightly warmer water if possible.
            {%- elif L == 3 -%}All good.
              {%- elif L == 4 -%}Refresh more often; shade barrel.
                {%- else -%}Cool water immediately; add electrolytes if heat stress.
                  {%- endif -%}
                  {%- endmacro %}
]}